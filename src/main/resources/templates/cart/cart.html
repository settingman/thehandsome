<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="./css/reset.css">
<link rel="stylesheet" href="./css/common.css">
<link rel="stylesheet" href="./css/style.css">
<title>쇼핑백</title>
</head>
<body>
<!-- 삭제 form -->
<!-- <form th:action=/cart/delete/${mid}/${psid}" method="post" class="quantity_update"></form> -->
	<div id="wrap" class="p_cart">
		<!-- header :: S -->
		<header id="header">
			<h1 class="page_ttl">쇼핑백</h1>
			<div class="page_util">
				<a href="" class="back_btn">뒤로 가기</a> <a href="/" class="home_btn">메인으로
					가기</a>
			</div>
			<div class="home_util">
				<a href="#" class="search_btn">검색창 바로가기</a> <a href="./cart.html"
					class="cart_btn"> <span class="count">3</span> 장바구니 바로가기
				</a>
			</div>
		</header>
		<!-- header :: E -->
		<!-- contents :: S -->
		<div id="contents">
			<div class="cart_tab">
				<ul>
					<li class="on"><a href="#" class="btn">택배(<span
							class="count">3</span>)
					</a></li>
					<li><a href="#" class="btn">매장수령(<span class="count">0</span>)
					</a></li>
					<li><a href="#" class="btn">퀵배송(<span class="count">0</span>)
					</a></li>
				</ul>
			</div>
			<p class="cart_notice">4PM 상품은 오후 4시 이후 주문 시 일반 택배 상품으로 발송됩니다.</p>

			<div class="cart_all">
				<div class="check_item">
					<input type="checkbox" name="" id="check_all"> <label
						for="check_all">담은 상품(<span class="count2">[[${cartlist.size}]]</span>개)
					</label>
				</div>
			</div>


			<div class="cart_list">
				<!-- 상품 리스트 뿌려주기 -->
					<li class="cart_item" th:each="item, idx: ${cartlist}">
					
						<div class="cart_util">
							<div class="check_item">
								<input type="checkbox" name="" id="cart_item" th:id="'gl_check_'+${idx.count}" /> 
								<label for="cart_item" th:for="'gl_check_'+${idx.count}"></label>
							</div>
							<ul class="prd_status">
								<li><span class="sold_out">sold out</span></li>
								<li><span class="quick_delivery">4PM</span></li>
							</ul>
							<button type="button" class="like_btn">좋아요</button>
							<a type="button" class="del_btn"  th:data-psid="${item.psid}" th:data-mid= "${item.mid}"
							 th:href="@{/cart/delete/{mid}/{psid}(mid = ${item.mid}, psid=${item.psid})}">
							 삭제
							 </a>
						
						</div>
						<div class="prd_info">
							<a href="#">
								<figure class="img">
								<img th:src= "${item.pcimg1}">
					
								</figure>
								
								<div class="txt">
									<span class="brand">[[${item.bname}]]</span> 
									<span class="name">[[${item.pname}]]</span> 
									<p class="price">[[${item.pcprice}]]원</p>
								</div>
							</a>
						</div>
						<div class="prd_opt">
							<dl>
								<dt>옵션수량</dt>
								<dd>
									<span class="color">[[${item.pcolorname}]]</span> <span class="size">[[${item.psize}]]</span> 
									<span class="count">[[${item.pquantity}]]개</span>
								</dd>
							</dl>

							<button type="button" class="opt_change">변경</button>
						</div>
						<div class="change_form">
							<dl>
								<dt>색상</dt>
								<dd>
									<div class="color_list_box">
										<ul class="color_list">
											 <li>
                                                <div class="color_chip">
                                                    <input type="radio" name="color" value="violet" id="violet" checked>
                                                    <label for="violet" th:style="|background-image: url(${item.pcchipimg})|"></label>
                                                </div>
                                            </li>
											
									
										</ul>
										<span class="color_name">	1</span>
									</div>
								</dd>
							</dl>
							<dl>
								<dt>사이즈</dt>
								<dd>
								
									<select name="" id="">
								
										<option th:each = "size: ${item.sizeList}" th:value="${size}">[[${size}]]</option>
										
									</select>
								</dd>
							</dl>
							<dl>
								<dt>수량</dt>
								<dd>
									<div class="count_box">
										<button type="button" class="minus_btn">감소</button>
										<!-- <input type="tel" name="" id="" value="1"> -->
										<input type = "tel" name ="" id="">
										<button type="button" class="plus_btn">증가</button>
									</div>
								</dd>
							</dl>
							<div class="btn_row">
								<button type="button" class="btn bg_gray cancel_btn">취소</button>
								<button type="button" class="btn bg_black save_btn">저장</button>
							</div>
						</div>
					</li>
				</ul>
			</div>

			<div class="cart_final">
				<h2 class="cart_ttl">
					총 <span class="count">0</span>개 상품
				</h2>
				<dl>
					<dt>상품 합계</dt>
					<dd></dd>
					<span class="total_price">₩<span id="total2"></span> </span>
				</dl>
				<dl>
					<dt>배송비</dt>
					<dd>₩0</dd>
				</dl>
				<dl class="total">
					<dt>합계</dt>
					<dd></dd>
					<span class="total_price"> 총 결제금액 :  <span id="total2"> </span> </span>
				</dl>

				<div class="btn_row">
					<button type="button" class="btn default">품절상품 삭제</button>
					<button type="button" class="btn default" id="selectDelete_btn">선택상품 삭제</button>
					
				</div>
				<div class="btn_row">
					<button type="button" class="btn bg_black">선택상품 주문하기</button>
				</div>
			</div>

			<div class="fix_bar">
				<div class="check_off">
					<p class="no_select">주문하실 상품을 선택해 주세요</p>
				</div>
				<div class="check_on">
					<button type="button" class="order_btn">
						<span class="total_price"> 총 결제금액 :  <span id="total"> 원</span> </span> 
						<span class="order_txt">주문하기</span>
					</button>
				</div>
			</div>

		</div>
		<!-- contents :: E -->
		<!-- footer :: S -->
		<footer id="footer">
			<div class="notice_row">
				<h2 class="notice_ttl">공지</h2>
				<div class="notice_link">
					<a href="#">더한섬닷컴 편집/해외 브랜드 종료(예정) 안내(~2/22)</a>
				</div>
				<a href="#" class="notice_more">공지사항 바로가기</a>
			</div>
			<div class="foot_inner">
				<div class="foot_top">
					<ul class="foot_list">
						<li><a href="#">로그인</a></li>
						<li><a href="#">고객센터</a></li>
						<li><a href="#">매장안내</a></li>
						<li><a href="#">한섬 회원 혜택</a></li>
						<li><a href="#">회사소개</a></li>
						<li><button type="button">family site</button></li>
					</ul>
					<ul class="sns_list">
						<li><a href="#" target="_blank" class="insta">인스타그램 바로가기</a></li>
						<li><a href="#" target="_blank" class="youtube">유튜브 바로가기</a></li>
					</ul>
				</div>
				<div class="foot_bot">
					<ul class="foot_terms">
						<li><a href="#">서비스이용약관</a></li>
						<li><a href="#"><strong>개인정보처리방침</strong></a></li>
						<li>
							<div class="lang">
								<select name="" id="">
									<option value="">LANGUAGE</option>
									<option value="">한국어</option>
									<option value="">ENGLISH</option>
									<option value="">中文</option>
								</select>
							</div>
						</li>
					</ul>
					<p class="copy">COPYRIGHT © 2018 HANDSOME. ALL RIGHT RESERVED</p>
					<div class="foot_info">
						<button type="button" class="toggle_btn">
							<span>(주) 한섬</span> <span><img
								src="./images/mob-footer-logo.png" alt=""></span> <span
								class="arrow"></span>
						</button>
						<div class="toggle_cont">
							<address>
								<span>대표이사 : 김민덕</span> <span>서울시 강남구 도산대로 523 한섬빌딩</span> <br>
								<span>TEL : 1800-5700 (유료)</span> <span>FAX :
									02-6078-2856</span> <br> <span>개인정보보호책임자 : 윤인수</span> <span>호스팅서비스
									: (주) 한섬</span> <br> <span>사업자등록번호 : 120-81-26337</span> <br>
								<span>통신판매업신고번호 : 제 2009-서울강남-00826호</span>
							</address>
							<ul class="other_link">
								<li><a href="#">채용정보</a></li>
								<li><a href="#">동반성장</a></li>
								<li><a href="#">환경경영</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</footer>
		<!-- footer :: E -->
		<button type="button" id="top_btn">위로가기</button>
	</div>
	<script src="./js/jquery-3.6.3.min.js"></script>
	<script src="./js/cartscript.js"></script>
	
<script>
// 가격
    document.addEventListener("DOMContentLoaded", function () {
        // Get the checkbox elements
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
		const pmbutns = document.querySelectorAll('input[type="count_box"]');
		
        // Get the price elements
        const prices = document.querySelectorAll('.price');
        

        // Calculate the total price
        
        for (let i = 1; i <= checkboxes.length; i++) {
        	console.log("check")
            checkboxes[i].addEventListener('change', function () {
            	
            	let total=0;
            	for (let i = 1; i < checkboxes.length; i++) {
        			
        			if($('#gl_check_'+i).is(':checked')){
        				total += parseInt(prices[i-1].innerText);
        			}
        		}
                let origin = intToWon(total);
                console.log(origin);
                document.getElementById('total').innerText = origin;
                document.getElementById('total2').innerText = origin;
            });
        }
        
        
        
    });
    
    function wonToInt(s) {
        return parseInt(s.substr(0, s.length - 1).replaceAll(',', ''));
      }
    
    function intToWon(s) {
        
        return s.toLocaleString() + '원';
      }
    
    // 가격
    /* const increaseButton = document.querySelector('.increase');
    const count = document.querySelector('.count');
    const price = document.querySelector('.price');

    increaseButton.addEventListener('click', function () {
      count.innerText = parseInt(count.innerText) + 1;
      price.innerText = count.innerText * 1000 + '원';
      
    });
    console.log(price[0]); */
    
    
   $(document).on("click", '.btn', function(){
    	
        var prodid = $(this).prop('id').split("_");
        
        if(prodid[0] == 'optCancelLayer'){
            $(this).parents('.basket_info').slideUp('fast');
        }
        
        
        // 개수변경
        if(prodid[0] == 'QuantityProduct'){
            var form = $('#updateCartForm' + prodid[1]);
            var psid = form.find('input[name=psid]').val(); 
            //var initialCartQuantity = form.find('input[name=initialQuantity]').val();
            var newCartQuantity = form.find('input[name=pquantity]').val();
            var cartData = form.data("cart");
            var mid = $("#mid").val();
            console.log("개수변경중입니다");
            console.log(psid);
            console.log(initialCartQuantity);
            console.log(newCartQuantity);
     
            // 초기값과 다르면
            //if(initialCartQuantity != newCartQuantity)
            if(true)	
            {
            	
            	$.ajax({
                    type: "GET",
                    url: "cartAjax/updateQuantity/"+ mid +"/"+ psid +"/"+ newCartQuantity,
                    async : false,
                    cache : false,			
                    data: {},
                    success: function(){
                        console.log("성공!");
                        location.reload();
                        
                    },
                    error: function(xhr,  Status, error) {
                        alert('sendRequest error : ' + xhr.status + " ( " + error + " ) " );
                    }
                });	 
            }
        }
        
        // 물품 하나 삭제
        if(prodid[0] == 'RemoveProduct'){
        	var mid =$("#mid").val();
            var form = $('#updateCartForm' + prodid[1]);
            var psid = form.find('input[name=psid]').val(); 
            var pquantity = form.find('input[name=pquantity]');
            var cartData = form.data("cart");
            
          
             $.ajax({
                type: "GET",
                url: "/cartAjax/RemoveProduct/"+mid+"/"+psid,
                dataType: "json",
                async : false,
                cache : false,			
                data: {},
                success: function(data){
                    console.log("성공!");
                    location.reload();
                    cartCount();
   
                },
                error: function(xhr,  Status, error) {
                    alert('sendRequest error : ' + xhr.status + " ( " + error + " ) " );
                }
            });	 
        }
        
        if(prodid[0] == 'UpdateCart'){
            var form = $('#updateCartForm' + prodid[1]);
            var productCode = form.find('input[name=productCode]'); 
            var initialCartQuantity = form.find('input[name=initialQuantity]');
            var cartQuantity = form.find('input[name=quantity]');
            var chgProductCode = form.find('input[name=chgProductCode]').val();
            var storeId = form.find('input[name=storeId]').val();
            var storePickupDate = form.find('input[name=storePickupDate]').val();
            var cartData = form.data("cart");
            
            if($(".fourpm").length > 0){
            	form.find('input[name=deliveryKind]').val("4PM");
            }else{
            	form.find('input[name=deliveryKind]').val("");
            }
            
            if(chgProductCode == ''){
                layerAlert('사이즈를 선택해 주세요.');
                return;
            }
            
            if(chgProductCode != ''){
                productCode.val(chgProductCode);
            }
            
            form.prop('action', '/ko/shoppingbag/updateCartProduct'); 
            form.submit();
        }
        
        if(prodid[0] == 'deliveryTypeChange'){
    		var checkedVal = "";
    		var storeInfo = "";
     		$("input[type='radio'][name='deliveryType"+prodid[1]+"']:checked").each(function(){
    			if($(this).prop("checked") == true) {
    				checkedVal = $(this).val();
    				storeInfo = $(this).data("storeinfo");
    				return false;
    			}
    		});
        	
     		if(checkedVal == "") {
     			layerAlert("선택되지 않았습니다.");
     			return false;
     		}
     		
     		if(checkedVal == "store") {
	     		//layerAlert('개발중입니다.');
	     		deliveryKindChange(prodid[1], "store", storeInfo);
     		} else {
     			deliveryKindChange(prodid[1], "", "");
     		}
        }
        
    });
   
</script>

<!-- chat -->


</body>
</html>