<html xmlns:th="http://www.thymeleaf.org">
  <th:block th:fragment="depth1Fragment">
      <input type="hidden" id="isSetNewDelivery" value="false" />

      <!-- layerpop_wrap | 다른배송지선택 s -->
      <div class="layerpop_wrap layerpop_wrap_full lp_find_other_dlvr_wrap">
        <!-- layerpop_top s -->
        <div class="lyrpp_top">
          <a
            href="#none"
            class="lyrpp_close lyrpp_close_stl1 btn_lyrpp_close delivery_pop_close"
            ><span>닫기</span></a
          >
          <h2>나의 배송지에서 검색</h2>
        </div>
        <!-- layerpop_top e -->
        <!-- layerpop_middle s -->
        <div class="mp_mng_dlvr_wrap">
          <ul class="ui_tab red_border_tab fw active">
            <li class="on" onclick="fn_viewTapChange('tab_01')">
              <a href="#" onclick="" data-name="deliveryPage" data-gubun="1">
                나의 배송지 목록<!-- 나의 배송지 --></a
              >
            </li>
            <li class="" onclick="fn_viewTapChange('tab_02')">
              <a href="#" data-name="deliveryPage" data-gubun="2">
                최근 배송지 목록<!-- 최근 배송지 --></a
              >
            </li>
            <li class="fcs" style="transform: translateX(0px)"></li>
          </ul>

          <div class="tab_cont">
            <div id="tab_01" class="cont on">
              <ul class="btn_wrap btn_wrap_div1 mt0 pb0">
                <li>
                  <a
                    href="/member/mydeliveryRegistePopup?depth=2"
                    data-layerpop-depth="depth2"
                    class="btnstl3 border_btn_blk btn_layerpopup_call"
                    >배송지 새로 입력</a
                  >
                  <div class="call_link_registe_mydelivery"></div>
                </li>
              </ul>

              <ul id="radio_list_wrap_01" class="radio_list_wrap mt0"></ul>
            </div>
            <div id="tab_02" class="cont">
              <ul id="radio_list_wrap_02" class="radio_list_wrap mt0"></ul>
            </div>
          </div>

          <!-- layerpop_btns s -->
          <div class="btn_wrap btn_wrap_div2 btn_group_mydelivery">
            <a
              href="#none"
              class="btnstl3 border_btn_gray btn_lyrpp_close delivery_pop_close"
              id="deliDepth1Close"
              ><span>취소</span></a
            >
            <a href="#none" class="btnstl3 solid_btn_blk" id="deliDepth1Save"
              ><span>확인</span></a
            >
          </div>
          <!-- layerpop_btns e -->
        </div>
        <!-- layerpop_middle e -->
      </div>
      <!-- layerpop_wrap | 다른배송지선택 e -->
      <script>
        $(document).ready(function () {
          $(".call_link_registe_mydelivery").off();
          $(".call_link_registe_mydelivery").on("click", function () {
            var params = "pageNum=1&pageSize=20&sort=true";

            $.ajax({
              type: "GET",
              url: "/ko/mypage/myDeliveryList",
              data: params,
              dataType: "json",
              error: function (request, status, error) {
                alert("error:" + error);
              },
              success: function (result) {
                // console.log(result);
                var addressCount = 0;
                var innerHTML = "";

                var defaultShipmentAddress = "";

                result.results.forEach(function (data) {
                  addressCount++;
                  var prk = data.prk == null ? "" : data.prk;
                  var email = data.email == null ? "" : data.email;
                  var phone1 = data.phone1 == null ? "" : data.phone1;
                  var firstname = data.firstname == null ? "" : data.firstname;
                  var lastname = data.lastname == null ? "" : data.lastname;
                  var cellphone = data.cellphone == null ? "" : data.cellphone;
                  var postalcode =
                    data.postalcode == null ? "" : data.postalcode;
                  var streetname =
                    data.streetname == null ? "" : data.streetname;
                  var streetnumber =
                    data.streetnumber == null ? "" : data.streetnumber;
                  var countryCode =
                    data.countryCode == null ? "" : data.countryCode;
                  var state = data.state == null ? "" : data.state;
                  var town = data.town == null ? "" : data.town;

                  var bk_flag = defaultShipmentAddress == prk ? "bk_flag" : "";

                  innerHTML +=
                    '	<li class="radio_list_item item_select_mydelivery">';
                  innerHTML += '		<div class="radio_stl">';
                  innerHTML +=
                    '			<input type="radio" id="lp_radio_dlvr_adrs_' +
                    addressCount +
                    '" name="lp_radio_dlvr_adrs" value="' +
                    prk +
                    '"';
                  innerHTML += '				data-email="' + email + '"';
                  innerHTML += '				data-phone1="' + phone1 + '"';
                  innerHTML += "				/>";
                  innerHTML +=
                    '				<label for="lp_radio_dlvr_adrs_' + addressCount + '">';
                  innerHTML += '					<div class="rlct_con ' + bk_flag + ' aa">';
                  innerHTML +=
                    '						<span class="dlvr_adrs_name">' +
                    lastname +
                    '</span> / <span class="dlvr_adrs_phone">' +
                    cellphone +
                    "</span><br>";
                  innerHTML +=
                    '						(<span class="dlvr_adrs_zipcode">' +
                    postalcode +
                    "</span>)";
                  innerHTML += '						<span class="dlvr_adrs_adrs">';
                  innerHTML +=
                    '							<span class="mydeliveryLine1">' + streetname + "</span>";
                  innerHTML +=
                    '							<span class="mydeliveryLine2">' + streetnumber + "</span>";
                  innerHTML += "						</span>";
                  innerHTML +=
                    '						<span class="none_delivery" style="display:none;">';
                  innerHTML +=
                    '							<span class="none_delivery_firstName">' +
                    firstname +
                    "</span>";
                  innerHTML +=
                    '							<span class="none_delivery_lastName">' +
                    lastname +
                    "</span>";
                  innerHTML +=
                    '							<span class="none_delivery_country">' +
                    countryCode +
                    "</span>";
                  innerHTML +=
                    '							<span class="none_delivery_state">' + state + "</span>";
                  innerHTML +=
                    '							<span class="none_delivery_town">' + town + "</span>";
                  innerHTML += "						</span>";
                  innerHTML += "					</div>";
                  innerHTML += "				</label>";
                  innerHTML += "			</div>";
                  innerHTML += "	</li>";
                });

                if (innerHTML != "") {
                  $("#radio_list_wrap_01").html(innerHTML);
                }
              },
            });
          });

          $("#deliDepth1Save").on("click", function () {
            if (
              !$(
                "li.item_select_mydelivery input:radio[name=lp_radio_dlvr_adrs]"
              ).is(":checked")
            ) {
              layerAlert("주소를 선택하세요");
              return;
            }

            // callback
            var checkedMyDelivery = $(
              "li.item_select_mydelivery input:radio[name='lp_radio_dlvr_adrs']:checked"
            );
            var callbackData = {
              pk: checkedMyDelivery.val(),
              name: checkedMyDelivery.parent().find(".dlvr_adrs_name").html(),
              email: checkedMyDelivery.data("email"),
              phone: checkedMyDelivery.data("phone1"),
              cellphone: checkedMyDelivery
                .parent()
                .find(".dlvr_adrs_phone")
                .html(),
              zipcode: checkedMyDelivery
                .parent()
                .find(".dlvr_adrs_zipcode")
                .html(),
              address1: checkedMyDelivery
                .parent()
                .find(".mydeliveryLine1")
                .html(),
              address2: checkedMyDelivery
                .parent()
                .find(".mydeliveryLine2")
                .html(),
              address2_raw: checkedMyDelivery
                .parent()
                .find(".mydeliveryLine2")
                .text(),
              firstName: checkedMyDelivery
                .parent()
                .find(".none_delivery_firstName")
                .html(),
              lastName: checkedMyDelivery
                .parent()
                .find(".none_delivery_lastName")
                .html(),
              country: checkedMyDelivery
                .parent()
                .find(".none_delivery_country")
                .html(),
              state: checkedMyDelivery
                .parent()
                .find(".none_delivery_state")
                .html(),
              town: checkedMyDelivery
                .parent()
                .find(".none_delivery_town")
                .html(),
              defaultShipmentAddress: "",
            };

            if ("" != "") {
              window[""](callbackData);
            } else if (typeof fn_mydeliverycallback === "function") {
              fn_mydeliverycallback(callbackData);
            }
            $("#isSetNewDelivery").val("true");
            $("#deliDepth1Close").trigger("click");
          });

          $(".delivery_pop_close").on("click", function () {
            if (
              typeof fn_setShippingAddresses === "function" &&
              $("#isSetNewDelivery").val() == "false"
            ) {
              fn_setShippingAddresses("", "");
            }
          });
        });

        function fn_viewTapChange(tabNo) {
          if (tabNo == "tab_01") {
            $("#tab_02").removeClass("on");
            $("#tab_01").addClass("on");
            $(
              "#tab_02 li.item_select_mydelivery input:radio[name='lp_radio_dlvr_adrs']:checked"
            ).removeAttr("checked");
          } else if (tabNo == "tab_02") {
            $("#tab_01").removeClass("on");
            $("#tab_02").addClass("on");
            $(
              "#tab_01 li.item_select_mydelivery input:radio[name='lp_radio_dlvr_adrs']:checked"
            ).removeAttr("checked");
          }
        }

        function fn_maxDeliveryAddressAlert() {
          layerAlert("더 이상 등록 할 수 없습니다."); // 더 이상 등록 할 수 없습니다.
        }

        function regionCheck(self) {
          globalOrderInitialize();

          var isocode = $(self).val();
          $("#globalStreet_info").remove();
          $("#globalStreet2_info").remove();
          $("#city_info").remove();
          $("#state_info").remove();
          $("#zipcode_info").remove();

          if (isocode != "") {
            //20210531 배송지 -> 영국 25만원 조건 추가
            if (isocode == "GB") {
              var totalPrice = $("#total").val();
              totalPrice = totalPrice != null ? Number(totalPrice) : 0;
              if (totalPrice < 250000) {
                var la = new layerAlert("checkout.alert.region.unitedkingdom");
              }
            }
            /*
		if(isocode == "CN") {
			$("#globalStreet").attr('placeholder', 'checkout.shipto.chn.placeholder');
			$("#globalStreet2").attr('placeholder', 'checkout.shipto.chn.placeholder');
			$("#city").attr('placeholder', 'checkout.shipto.chn.placeholder');
			$("#state").attr('placeholder', 'checkout.shipto.chn.placeholder');
		} else {
		*/
            $("#globalStreet").attr(
              "placeholder",
              "checkout.shipto.eng.placeholder"
            );
            $("#globalStreet2").attr(
              "placeholder",
              "checkout.shipto.eng.placeholder"
            );
            $("#city").attr("placeholder", "checkout.shipto.eng.placeholder");
            $("#state").attr("placeholder", "checkout.shipto.eng.placeholder");
            //}

            $("#globalStreet_li").before(
              '<div id="globalStreet_info" class="desc_box pt10 pl10">Input Your Street Address 1</div>'
            );
            $("#globalStreet2_li").before(
              '<div id="globalStreet2_info" class="desc_box pt10 pl10">Input Your Street Address 2</div>'
            );
            $("#city_li").before(
              '<div id="city_info" class="desc_box pt10 pl10">Input Your City</div>'
            );
            $("#state_li").before(
              '<div id="state_info" class="desc_box pt10 pl10">Input Your State</div>'
            );
            $("#zipcode_li").before(
              '<div id="zipcode_info" class="desc_box pt10 pl10">handsome.mobile.mypage.order.global.ph.zipcode.info</div>'
            );
          } else {
            $("#globalStreet").attr(
              "placeholder",
              "Input Your Street Address 1"
            );
            $("#globalStreet2").attr(
              "placeholder",
              "Input Your Street Address 2"
            );
            $("#city").attr("placeholder", "Input Your City");
            $("#state").attr("placeholder", "Input Your State");
          }
        }

        function globalOrderInitialize() {
          $("#globalStreet").val("");
          $("#globalStreet2").val("");
          $("#city").val("");
          $("#state").val("");
          $("#zipCode").val("");
          $("#phoneNumber").val("");
        }

        function checkValidation() {
          var inputTextchk = /^[0-9a-zA-Z\s]+$/;
          var inputadresschk = /^[0-9a-zA-Z-\s/-]+$/;
          var inputNumberchk = /^[0-9]+$/;

          // 	if (!inputTextchk.test($("#firstName").val()) && ($("#firstName").val().length > 0) )  {
          // 		var lc = new layerAlert("mypage.delivery.pc.firstName : "+"checkout.shipto.onlyeng.msg" );
          // 		lc.confirmAction = function(){$("#firstName").focus();};
          // 		return false;
          // 	}
          if (
            !inputTextchk.test($("#lastName").val()) &&
            $("#lastName").val().length > 0
          ) {
            var lc = new layerAlert(
              "mypage.delivery.pc.lastName : " + "checkout.shipto.onlyeng.msg"
            );
            lc.confirmAction = function () {
              $("#lastName").focus();
            };
            return false;
          }
          // 	if (!inputadresschk.test($("#globalStreet").val()) && ($("#globalStreet").val().length > 0) ) {
          // 		var lc = new layerAlert("mypage.delivery.pc.streetAddress : "+"checkout.shipto.onlyeng.msg" );
          // 		lc.confirmAction = function(){$("#globalStreet").focus();};
          // 		return false;
          // 	}
          // 	if (!inputadresschk.test($("#globalStreet2").val()) && ($("#globalStreet2").val().length > 0) ) {
          // 		var lc = new layerAlert("mypage.delivery.pc.streetAddress2 : "+"checkout.shipto.onlyeng.msg" );
          // 		lc.confirmAction = function(){$("#globalStreet2").focus();};
          // 		return false;
          // 	}
          // 	if (!inputTextchk.test($("#city").val()) && ($("#city").val().length > 0) ) {
          // 		var lc = new layerAlert("mypage.delivery.pc.city : "+"checkout.shipto.onlyeng.msg" );
          // 		lc.confirmAction = function(){$("#city").focus();};
          // 		return false;
          // 	}
          // 	if (!inputTextchk.test($("#state").val()) && ($("#state").val().length > 0) ) {
          // 		var lc = new layerAlert("mypage.delivery.pc.state : "+"checkout.shipto.onlyeng.msg" );
          // 		lc.confirmAction = function(){$("#state").focus();};
          // 		return false;
          // 	}
          if (
            !inputTextchk.test($("#zipCode").val()) &&
            $("#zipCode").val().length > 0
          ) {
            var lc = new layerAlert(
              "mypage.delivery.pc.postalCode : " + "checkout.shipto.zipcode.msg"
            );
            lc.confirmAction = function () {
              $("#zipCode").focus();
            };
            return false;
          }
          if (
            !inputNumberchk.test($("#phoneNumber").val()) &&
            $("#phoneNumber").val().length > 0
          ) {
            var lc = new layerAlert(
              "mypage.delivery.pc.phoneNumber : " + "checkout.shipto.phone.msg"
            );
            lc.confirmAction = function () {
              $("#phoneNumber").focus();
            };
            return false;
          }

          return true;
        }
      </script>
  </th:block>
</html>
